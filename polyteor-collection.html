<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="polyteor-query.html">

<!--
    
An element to query a single meteor collection.

Example:

      <template is="dom-bind">
        <polyteor-collection collection="todos" data="{{todos}}" 
            sort="[[sortDef]]" autoupdate>        
        </polyteor-collection>
      </template>
      
@demo /
-->

<dom-module id="polyteor-collection">
    <template>
        <polyteor-query query="{{query}}" data="{{data}}" autoupdate="{{autoupdate}}" log="{{log}}"></polyteor-query>
    </template>
    <script>
        (function () {
    'use strict';

    Polymer({
        is: 'polyteor-collection',
        properties: {
            data: {
                type: Array,
                notify: true

            },
            collection: {
                type: String,
                reflectToAttribute: true,
                notify: true,
                value: null
            },
            selector: {
                type: Object,
                notify: true,
                value: null
            },
            sort: {
                type: Object,
                notify: true,
                value: null
            },
            limit: {
                type: Number,
                notify: true,
                reflectToAttribute: true,
                value: null
            },
            fields: {
                type: Object,
                notify: true,
                value: null
            },
            skip: {
                type: Number,
                notify: true,
                value: null,
                reflectToAttribute: true
            },
            query: {
                type: Object,
                notify: true,
                computed: '_computeQuery(collection, selector, sort, fields, limit, skip)'
            },
            /**
             * If true, verbose debugging information will be printed to the console.
             */
            log: {
                type: Boolean,
                value: false,
                reflectToAttribute: true
            },
            autoupdate: {
                type: Boolean,
                value: false,
                relfectToAttribute: true
            }
        },
        _computeQuery: function (collection, selector, sort, fields, limit, skip) {
            this._log('Computing query with', selector, fields, limit, skip);
            return {
                find: function () {
                    return {
                        selector: selector,
                        sort: sort,
                        fields: fields,
                        limit: limit,
                        skip: skip,
                        collName: collection
                    }
                }
            };

        },

        attached: function () {
            this._log('polyteor-collection was attached');
        },

        detached: function () {
            this._log('polyteor-collection was detached');

        },
        _log: function () {
            var args;
            if (this.log) {
                args = Array.prototype.slice.call(arguments).map(function (arg) {
                    if (arg && typeof arg.val === 'function') {
                        return arg.val();
                    }
                    return arg;
                });
                console.log.apply(console, args);
            }
        }
    });
})();
    </script>
</dom-module>